<% provide(:title, I18n.t("conversations.messages.title")) %>


<div class="page_header">
  <h1><%= t "conversations.messages.title" %></h1>

  <h2><%= @conversations.count() %></h2>

  <%= link_to "+ " + I18n.t("conversations.messages.new"), new_conversation_path, class: "bluebtn page_header_button tooltip-info",
              "data-placement" => "bottom",
              "data-title" => "Create new message" %>
</div>


<% if @conversations.empty? %>

    <div class="no-alerts">
      <p class="center"><%= t "conversations.messages.no_conversations" %></p>
    </div>

<% else %>
    <div class="messages-container">

      <%= render 'conversations/conversation_full', conversation: @conversations.first %>

      <ol id="conversations_list" class="conversations-list">
        <%= render @conversations %>
      </ol>

      <%= will_paginate inner_window: 0, outer_window: 0 %>

    </div>

<% end %>

<script type="text/javascript">
    var pusher = new Pusher('9f7a931d636464d8a7c3');
    var channel = pusher.subscribe('chat_<%= current_user.company.id %>');
    channel.bind('new_message', function(data) {
        if(data.user_id == "<%= current_user.id %>") {
            $.ajax('/conversations/' + $('#messages').attr("data-id") + "?check_new=true", {
                type: 'get',
                dataType: 'script'
            });
        }
    });
</script>