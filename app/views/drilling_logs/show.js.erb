tray = $(".remote-tray[data-tray='<%= params[:section] %>']");
if(!tray.hasClass('custom-data-closed')) {
function removeOldContent(section) {
    $('.remote-tray').each(function() {
        if($(this).hasClass('custom-data-closed')) {
            generating_report = $(this).find('.generating-report:not(.hidden)');
            download_report = $(this).find('.download-report:not(.hidden)');
            if(generating_report.length > 0 || download_report.length > 0) {

            }
            else {
                $(this).find('.tray-content').remove();
                $(this).find('.tray-content').removeClass('content-loaded');
            }
        }
    });
}

removeOldContent('<%= params[:section] %>');

<% if params[:section] == "drilling-overview" %>
    tray.replaceWith("<%= j render 'drilling_logs/tray_overview', drilling_log: @drilling_log %>");

    <% if @drilling_log.job.status == Job::ON_JOB %>
        setTimeout(function() {
            $.ajax('/drilling_logs/' + <%= @drilling_log.id %> + "?section=drilling-overview", {
                type: 'get',
                dataType: 'script'
            });
        }, 1000 * 60 * 5);
    <% end %>

<% elsif params[:section] == "log" %>
    tray.replaceWith("<%= j render 'drilling_logs/tray_log', drilling_log: @drilling_log %>");
    $('#drilling_log_filter').trigger("change");
    $('.custom-select').customSelect();
    $('.date-picker').datepicker();
<% elsif params[:section] == "drilling-rop" %>
    tray.replaceWith("<%= j render 'drilling_logs/tray_rop', drilling_log: @drilling_log %>");
<% elsif params[:section] == "drilling-runs" %>
    tray.replaceWith("<%= j render 'drilling_logs/tray_runs', drilling_log: @drilling_log %>");
<% elsif params[:section] == "drilling-daily" %>
    tray.replaceWith("<%= j render 'drilling_logs/tray_daily', drilling_log: @drilling_log %>");
<% elsif params[:section] == "drilling-bha" %>
    tray.replaceWith("<%= j render 'drilling_logs/tray_bha', drilling_log: @drilling_log %>");
<% elsif params[:section] == "drilling-npt" %>
    tray.replaceWith("<%= j render 'drilling_logs/tray_npt', drilling_log: @drilling_log %>");
<% elsif params[:section] == "drilling-reports" %>
    tray.replaceWith("<%= j render 'drilling_logs/tray_reports', drilling_log: @drilling_log %>");

    $('.generate-report').each(function() {
        $(this).click(function() {
            report = $(this).closest('.report');
            report.find('.generating-report').removeClass('hidden');
            $(this).addClass('hidden');
        });
    });
<% elsif params[:section] == "survey" %>
    tray.replaceWith("<%= j render 'drilling_logs/tray_survey', drilling_log: @drilling_log %>");
<% else %>
    hideWorkingCurtain();
    report = $(".report[data-report='<%= @report_name %>']");
    if(report.length > 0) {
        report.find('.generating-report').addClass('hidden');
        download_link = report.find('.download-report');
        download_link.attr('href', "<%= sanitize(@full_url) %>");
        download_link.removeClass('hidden');
    }
<% end %>

if (!window.matchMedia || !window.matchMedia("(max-device-width: 1024px)").matches) {
    $('.tooltip-info').tooltip();
}

$('.custom-select-ajax').customSelect();
}