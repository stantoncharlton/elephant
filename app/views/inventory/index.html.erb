<% on_hand = @district.parts.where(:status => Part::AVAILABLE).count %>

<% provide(:title, 'Inventory') %>

<div class="page_header">
  <h1>Inventory</h1>

  <div class="pull-right">
    <h3 class="inline push-left-small">&nbsp;District</h3>
    <%= link_to @district.name, @district, class: "activity-user-link" %>
  </div>
</div>


<div class="well">

  <div class="filter-search-box">
    <%= text_field_tag "", "", data: {autocomplete_source: parts_path},
                       placeholder: "Search for part...",
                       class: "txtfield search-query tooltip-info part-search",
                       id: "part_search",
                       "data-placement" => "left",
                       "data-title" => "Search in parts..." %>
  </div>

  <%= link_to "+ Add New Master Part", new_part_path(template: true, district: @district.id), class: "bluebtn tooltip-info pull-right",
              "data-placement" => "bottom",
              "data-title" => "Create new part" %>
</div>


<br>

<div class="chart-block tooltip-info"
     data-title="'Total Jobs' is the number of jobs being analyzed based on the set of filters.">
  <div class="chart-title">Parts</div>
  <div class="donut-chart-div">
    <div class="donut-text "><%= number_with_delimiter(@district.parts.count, :delimiter => ",") %></div>
    <div class="percentage ">parts</div>
  </div>
</div>

<div class="chart-block tooltip-info"
     data-title="'Personnel Utilization' refers to the ratio of active users on jobs compared by district and product line to all users on Elephant.">
  <div class="chart-title">Parts On Hand</div>
  <div class="donut-chart-div">
    <div id="personnel_utilization" class="donut-chart "></div>
    <div class="donut-inner-circle"></div>
    <div class="donut-text"><%= @district.parts.any? ? ((on_hand.to_f / @district.parts.count.to_f) * 100).round(0) : "0" %></div>
    <div class="percentage-circle">%</div>
  </div>
</div>

<div class="chart-block tooltip-info"
     data-title="'Average Job Duration' is the average duration of all jobs, represented in days.">
  <div class="chart-title">Average Part Redress</div>
  <div class="donut-chart-div">
    <div class="donut-text "><%= "1.2" %></div>
    <div class="percentage ">days</div>
  </div>
</div>



<div class="content">
  <h3>Recently Shipped</h3>
</div>

<hr>

<div class="content" id="jobs">
  <% @jobs.each do |job| %>
      <%= render 'jobs/job_progress_link', job: job %>
  <% end %>
</div>


<script>
    $(document).ready(function () {
        var plot3 = $.jqplot('personnel_utilization', [
            [
                ['a', <%= @district.parts.count %>],
                ['b', <%= on_hand %>]
            ]
        ], {
            animate: true,
            animateReplot: true,
            background: "#FFFFFF",
            seriesColors: [ "#458fd2", "#FFFFFF"],
            seriesDefaults: {
                textColor: " #00ff0000",
                shadow: false,
                renderer: $.jqplot.DonutRenderer,
                rendererOptions: {
                    animation: {
                        show: true,
                        speed: 2500
                    },
                    padding: 0,
                    innerDiameter: 95,
                    sliceMargin: 0,
                    startAngle: -90,
                    showDataLabels: true,
                    dataLabels: 'value'
                }
            }
        });

    });
</script>


<script type="text/javascript">
    (function ($) {
        $(document).ready(function () {
            $('.part-search').data("autocomplete")._renderItem = function (ul, item) {
                return $("<li class='item_" + item.id + "'></li>").data("item.autocomplete", item).append(
                        "<a><div>" + (item.id > 0 ? "<img src='/assets/tool.png' class='job-member-avatar pull-left'>" : "") + "</div><div><div class='job-user'><strong>" + item.value + " </strong>" + (item.id > 0 ? "<div>" + (item.district_serial_number != null ? ("<p class='job-user-title'><span class='help-text'>District # </span><b class='orange-text'>" + item.district_serial_number + "</b></p>") : "<p class='job-user-title'><b class='blue-text'>Master Part</b></p>") + "<p class='job-user-district'><span class='help-text'>Material # </span>" + item.material_number + "</p></div>" : "") + "</div></div></a>").appendTo(ul)
            }
        });
    }(jQuery));
</script>
