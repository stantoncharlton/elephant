<%= render 'jobs/duplicate_warning', job: @job %>

<div class="content">
  <%= render 'job_data', job: @job, form_editable: @job_editable, in_form: true, new_line_job_type: false %>
</div>


<%= render 'jobs/job_members', job: @job, job_editable: @job_editable %>


<div>
<div class="content">
  <hr>
  <ul class="nav nav-pills">
    <li>
      <a href="#" id="custom_data_toggle" class="custom-data-toggle tooltip-info"
         data-placement="bottom" data-title="Custom job data and values"><%= "Job Data" %>
        <%= "(" + @job.dynamic_fields.select { |df| (!df.dynamic_field_template.nil? and !df.dynamic_field_template.priority?) or (df.dynamic_field_template.nil? and !df.priority?) }.count.to_s + ")" %></a>
    </li>

    <li>
      <a href="#" id="job_tools_toggle" class="custom-data-toggle tooltip-info"
         data-placement="bottom" data-title="List of tools used on this job">Tools</a>
    </li>

    <li>
      <a href="#" id="job_options_toggle" class="custom-data-toggle tooltip-info"
         data-placement="bottom" data-title="Advanced options for controlling this job">Advanced Options</a>
    </li>
  </ul>

  <%= render 'jobs/job_custom_data', job: @job, job_editable: @job_editable %>

  <div class="custom-data-closed well well-large" id="job_tools">
    <div>
    </div>
  </div>


  <div class="custom-data-closed well well-large" id="job_options">
    <div>
    </div>
  </div>

  <hr>
  </div>
</div>


<div id="process_actions" class="content <%= ((@job.pre_job_data_good && @job.is_supervisor_or_creator?(current_user)) || @job.approved_to_close || (@job.pre_job_data_good && @job.post_job_data_good && @job.is_supervisor_or_creator?(current_user)) || @job.approved_to_ship) ? "well" : "" %>">

  <% @job.job_processes.select { |jp| jp.event_type == JobProcess::APPROVED_TO_SHIP }.each do |job_process| %>
      <%= render 'job_process/job_shipped', job_process: job_process %>
  <% end %>
  <% @job.job_processes.select { |jp| jp.event_type == JobProcess::APPROVED_TO_CLOSE }.each do |job_process| %>
      <%= render 'job_process/job_closed', job_process: job_process %>
  <% end %>
</div>



<%= render 'jobs/job_documents', job: @job %>



<div class="page_header">
  <h1>Notes/Failures</h1>
</div>
<%= render 'jobs/job_notes', job: @job, job_editable: @job_editable %>



<%= render 'activities/paginated_activity', activities: @activities, inside_job: true %>

<script type="text/javascript">
    (function ($) {
        $(document).ready(function () {


            // Needed in view because otherwise it conflicts with jquery menu. No idea?
            $('#new_member_name').data("autocomplete")._renderItem = function (ul, item) {
                return $("<li class='item_" + item.id + "'></li>").data("item.autocomplete", item).append(
                        "<a><div class='job-user'><strong>" + item.value + " </strong><div><p class='job-user-title'>" + item.position_title + "</p><p class='job-user-district'>" + item.district + "</p></div></div></a>").appendTo(ul)
            }
            $('#new_note_name').data("autocomplete")._renderItem = function (ul, item) {
                return $("<li class='item_" + item.id + "'></li>").data("item.autocomplete", item).append(
                        "<a><div class='job-user'><strong>" + item.value + " </strong><div><p class='job-user-title'>" + item.position_title + "</p><p class='job-user-district'>" + item.district + "</p></div></div></a>").appendTo(ul)
            }

            $.ajax({
                url:"/job_process/" + <%= @job.id.to_s %>,
                type:"GET",
                dataType:"script"
            });

        });
    }(jQuery));
</script>



