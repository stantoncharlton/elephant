<% if params[:section] == "tools_assets" %>
    if($('#assets_loading').length > 0) {
        $('#assets_loading').after('<%= j render 'jobs/job_assets', job: @job %>');
        $('#assets_loading').remove();
    }
    else {
        $('.job-tray[data-tray=tools_assets]').find('*').remove();
        $('.job-tray[data-tray=tools_assets]').append('<%= j render 'jobs/job_assets', job: @job %>');
    }

    $('.receive-shipment-button').live("click", function() {
       $(this).remove();
    });

    $('#show_assets').live("click", function() {
       $(this).addClass('hidden');
        $('#add_assets').removeClass('hidden');
        return false;
    });

    function show_assets(onsite) {
        $('#asset_list').find('.part-membership').each(function() {
            if(onsite && $(this).attr('data-shipping') == 'true') {
                $(this).addClass('hidden');
            }
            else {
                $(this).removeClass('hidden');
            }
        });
    }

    $("#show_all_assets").click(function() {
        show_assets(false);
        $(this).addClass('hidden');
        $("#show_onsite_assets").removeClass('hidden');
        return false;
    });
    $("#show_onsite_assets").click(function() {
        show_assets(true);
        $(this).addClass('hidden');
        $("#show_all_assets").removeClass('hidden');
        return false;
    });

    <% if @job.status != Job::COMPLETE %>
        show_assets(true);

        <% if @job.inbound_shipments.where(:status => Shipment::IN_TRANSIT).any? %>
            $('#inbound_shipments_link').trigger('click');
        <% end %>
    <% end %>

    $('.popover').popover({  delay: { show: 500, hide: 200 } });


    var focusevent, last_selected_item, part_focused,
            _this = this;

    last_selected_item = null;

    focusevent = function(event, ui) {
        var selected_item;
        if (last_selected_item !== null) {
            $('.item_' + last_selected_item.id).removeClass('ui-state-hover');
        }
        selected_item = $('.item_' + ui.item.id);
        selected_item.addClass('ui-state-hover');
        return last_selected_item = ui.item;
    };

    $('.part-search').each(function(index, element) {
        return $(element).autocomplete({
            source: $(element).data('autocomplete-source'),
            focus: focusevent,
            select: function(event, ui) {
                if (ui.item.id > 0) {
                    $('#part_membership_part_id').val(ui.item.id);
                    setTimeout(function() {
                        $('#part_search').val(ui.item.label + ' (Serial #' + ui.item.serial_number + ')');
                    }, 1);
                }
            }
        });
    });

    part_focused = false;

    $('.part-search').focusin(function() {
        part_focused = true;
        $(this).removeClass('ui-autocomplete-bad');
        $(this).addClass('ui-autocomplete-typing');
        return $(this).val('').trigger('keydown');
    });

    $('.part-search').focusout(function() {
        if (part_focused) {
            $(this).addClass('ui-autocomplete-bad');
            if ($(this).val() === '') {
                return $(this).removeClass('ui-autocomplete-typing');
            }
        }
    });


    $('.part-search').data("autocomplete")._renderItem = function (ul, item) {
        return $("<li class='item_" + item.id + "'></li>").data("item.autocomplete", item).append(
                "<a><div>" + (item.id > 0 ? "<img src='/assets/tool.png' class='job-member-avatar pull-left'>" : "") + "</div><div><div class='job-user'><strong>" + item.value + " </strong>" + (item.id > 0 ? "<p class='job-user-district pull-right help-text'>" + item.material_number + "</p>" : "") + (item.id > 0 ? "<div>" + (item.serial_number != null ? ("<p class='job-user-title'><span class='help-text'>Serial # </span><b class='orange-text'>" + item.serial_number + "</b>" + (item.district_serial_number != '' ? " / <span class='help-text'>District # </span><b class='orange-text'>" + item.district_serial_number + "</b>" : "") + "</p>") : "<p class='job-user-title'><b class='blue-text'>Master Part</b></p>") + "</div>" : "") + "</div><div style='margin: 0px;" + (item.id == -1 ? '' : "margin-left: 31px; margin-top: -5px;") + "'>" + item.status + "</div></div></a>").appendTo(ul)
    }




<% elsif params[:section] == "documents_data" %>
    $('#documents_loading').after('<%= j render 'jobs/job_documents', job: @job %>');
    $('#documents_loading').remove();

<% elsif params[:section] == "notes" %>
    $('#notes_loading').after('<%= j render 'jobs/job_notes', job: @job, job_editable: @job_editable %>');
    $('#notes_loading').remove();
<% elsif params[:section] == "cost" %>
    $('#cost_loading').after('<%= j render 'jobs/tray_cost', job: @job, job_editable: @job_editable %>');
    $('#cost_loading').remove();
    $('.date-picker').datepicker();
<% elsif params[:section] == "reports" %>
    $('#reports_loading').after('<%= j render 'jobs/tray_reports', job: @job, job_editable: @job_editable %>');
    $('#reports_loading').remove();

    $('.generate-report').each(function() {
        $(this).click(function() {
            report = $(this).closest('.report');
            report.find('.generating-report').removeClass('hidden');
            $(this).addClass('hidden');
            $(this).closest('.generate-report-div').addClass('hidden');
        });
    });


    $('.report-type').change(function() {
        report = $(this).closest('.report');
        report.find('.generate-report').removeClass('hidden');
        report.find('.download-report').addClass('hidden');
    });
<% elsif params[:section] == "job_failures" %>
    if($('#failures_loading').length > 0) {
        $('#failures_loading').after('<%= j render 'jobs/job_failures', job: @job %>');
        $('#failures_loading').remove();
    }
    else {
        var tray = $(".job-tray[data-tray='failures']");
        tray.find('*').remove();
        tray.append('<%= j render 'jobs/job_failures', job: @job %>');
    }
<% elsif params[:section] == "rating" %>
    if($('#map').length > 0) {
        $('#map').hide();
    }
    $('#modal_popup').css('visibility', 'visible');
    $('#modal_popup').height($(document).height() + 100);
    $('#modal_popup').find('.modal-popup').css('margin-top', 100);
    $('#modal_popup').find('.modal-content').append('<%= j render 'jobs/rating', job: @job %>');

<% elsif params[:section] == "overview" %>
    $('#job_overview').replaceWith('<%= j render 'jobs/job_overview', job: @job %>');

    <% if false %>
    <% if @job.status == Job::ON_JOB %>
    setTimeout(function() {
        $.ajax('/jobs/' + <%= @job.id %> + "?section=overview", {
            type: 'get',
            dataType: 'script'
        });
    }, 60000);
    <% end %>
    <% end %>
<% end %>

if (!window.matchMedia || !window.matchMedia("(max-device-width: 1024px)").matches) {
    $('.tooltip-info').tooltip();
}

$('.custom-select-ajax').each(function() {
    span_tag = $(this).next('span');
    if($(this).prop("tagName").toLowerCase() == 'select' && span_tag.length <= 0 && !span_tag.hasClass('customSelect')) {
        $(this).customSelect();
    }
});

