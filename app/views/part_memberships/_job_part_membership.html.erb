<% part = Part.where("parts.district_id = :district_id AND parts.material_number = :material_number AND parts.template is TRUE", district_id: job.district_id, material_number: part_membership.material_number).limit(1).first %>
<div id="part_membership_<%= part_membership.id %>" class="">

  <div class="inline add-part-match <%= part_membership.part.present? ? 'hidden' : '' %>">
    <%= form_for(PartMembership.new, :html => {class: "inline"}, remote: true) do |f| %>
        <%= f.hidden_field :template, value: false %>
        <%= f.hidden_field :material_number, value: part_membership.material_number %>
        <%= f.hidden_field :job_id, value: job.id %>
        <%= f.hidden_field :part_id, class: "part-id" %>
        <div class="filter-search-box pull-right">
          <%= text_field_tag "", "", data: {autocomplete_source: parts_path(material_number: part_membership.material_number, template: false)},
                             placeholder: "Search for part by district, serial, or material number...",
                             class: "txtfield search-query tooltip-info part-match",
                             "data-placement" => "left",
                             "data-title" => "Search in parts..." %>

          <a class="custom-data-toggle-jobs show-all-parts-material-number" data-part-fill="<%= (part.present? ? part.name : '') + ' ' + part_membership.material_number %>" href="#">
            All
          </a>
        </div>
    <% end %>
  </div>

  <div class="inline part-match-link part-field pull-right <%= part_membership.part.present? ? '' : 'hidden' %>">
    <% if part_membership.part.present? %>
        <%= link_to 'District #: ' + part_membership.part.district_serial_number + ' - Serial #:' + part_membership.part.serial_number, part_membership.part, class: "activity-user-link" %>
    <% end %>
    <% if job.status == Job::ACTIVE %>
        <%= link_to "remove", part_membership, method: :delete, remote: true,
                    data: {confirm: "Remove Part from job?"}, class: "delete-button tooltip-info",
                    "data-placement" => "bottom",
                    "data-title" => "Remove part from job" %>
    <% end %>
  </div>


  <div>
    <p class="help-text inline">Part</p><b class="push-right-small"><%= part.present? ? part.name : "" %></b>
    <br>

    <p class="help-text inline">Material Number</p>
    <span class="push-right-small"><%= part_membership.material_number %></span>
  </div>


  <% if part_membership.part.present? && job.approved_to_ship %>
      <div class="inline-part-receive">
        <div class="" data-form="receive-part-form">
          <br>

          <% if part_membership.part.present? %>
              <%= link_to "Receive Part", part_path(part_membership.part, receive: true),
                          method: :put,
                          remote: true,
                          class: "bluebtn green tooltip-info form-loading-on-click",
                          "data-form" => "receive-part-form",
                          "data-placement" => "bottom",
                          "data-title" => "Receive part" %>
          <% end %>
        </div>

        <div class="form-loading hidden" data-form="receive-part-form">
          <%= render 'layouts/inline_loading', title: "Receiving..." %>
        </div>
      </div>
  <% end %>
</div>
