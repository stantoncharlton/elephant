<div class="">
  <div class="alerts-calendar <%= show_full_calendar ? "alerts-calendar-large" : "" %>">
    <div class="header"></div>

    <% (show_full_calendar ? 42 : 14).times do |i| %>
        <div class="date">
          <p class="<%= adjusted_today_date.month != (start_date + i.days).month ? "number2" : "number" %> <%= ((start_date + i.days).day == Date.today.day && (start_date + i.days).month == Date.today.month) ? "today" : "" %>"><%= (start_date + i.days).day %></p>

          <div class="jobs">
            <% day_jobs = jobs.select { |j| !j.start_date.nil? && (j.start_date.day == (start_date + i.days).day) && (j.start_date.month == (start_date + i.days).month) } %>
            <% use_menu = day_jobs.count > 3 %>
            <% single = day_jobs.count == 1 %>
            <% day_jobs.each_with_index do |job, i| %>
                <% if !use_menu || (use_menu && i < 2) %>
                    <%= link_to job, class: "inline-block " + (single ? "user-calendar-day light-blue" : "job") do %>
                        <div class="tooltip-info "
                             data-placement="right"
                             data-html="true"
                             data-title="<%= "<div class='well-tooltip'>" +
                                                     (job.close_date.present? ? "" : "<p class='alert alert-info'><b class='blue-text'>" + job.status_string + "</b></p><br>") +
                                                     "<img src='" + image_path('rig_extrasmall.png') + "' class='job-status-avatar'><span class='help-text'>Rig</span> <b>&nbsp;" + job.well.rig_name + "</b><br>" +
                                                     "<img src='" + image_path('district_extrasmall.png') + "' class='job-status-avatar'><b>" + (job.district.present? ? job.district.name : "") + "</b><br>" +
                                                     "<br><b class='blue-text'>" + job.client.name + "</b>" +
                                                     "<br><b>" + (job.start_date.present? ? job.start_date.strftime("%m/%d/%Y") : job.created_at.strftime("%m/%d/%Y")) + "</b><br><br>" +
                                                     "<h3>" + job.job_template.product_line.name + " / " + job.job_template.name + "</h3>" +
                                                     "<hr><h3>" + job.dynamic_fields.select { |df| !df.template? && df.priority? }.map { |df| df.name + ": " + (df.value.present? ? df.value : "-") }.join("<br>") + "</h3>" +
                                                     "</div>" %>">
                          <% if single %>
                              <div class="inline-block calendar-day">
                                <p>
                                  <%= job.field.name %>
                                  <br>
                                  <b><%= job.well.name %></b>
                                </p>
                              </div>
                          <% else %>
                              <%= job.field.name + " | " + job.well.name %>
                          <% end %>
                        </div>
                    <% end %>
                <% end %>
            <% end %>

            <% if use_menu %>
                <div class="btn-group inline pull-left push-right-small">
                  <a class="custom-data-toggle-jobs" data-toggle="dropdown" href="#">
                    <p class='inline pull-left blue-text'><%= day_jobs.count - 2 %> More Jobs</p>
                  </a>
                  <ul class="dropdown-menu">
                    <% day_jobs.each_with_index do |job, i| %>
                        <% if i >= 2 %>
                            <li>
                              <%= link_to job, class: "job" do %>
                                  <p class="tooltip-info"
                                     data-placement="right"
                                     data-html="true"
                                     data-title="<%= "<div class='well-tooltip'>" +
                                                             (job.close_date.present? ? "" : "<p class='alert alert-info'><b class='blue-text'>" + job.status_string + "</b></p><br>") +
                                                             "<img src='" + image_path('rig_extrasmall.png') + "' class='job-status-avatar'><span class='help-text'>Rig</span> <b>&nbsp;" + job.well.rig_name + "</b><br>" +
                                                             "<img src='" + image_path('district_extrasmall.png') + "' class='job-status-avatar'><b>" + (job.district.present? ? job.district.name : "") + "</b><br>" +
                                                             "<br><b class='blue-text'>" + job.client.name + "</b>" +
                                                             "<br><b>" + (job.start_date.present? ? job.start_date.strftime("%m/%d/%Y") : job.created_at.strftime("%m/%d/%Y")) + "</b><br><br>" +
                                                             "<h3>" + job.job_template.product_line.name + " / " + job.job_template.name + "</h3>" +
                                                             "<hr><h3>" + job.dynamic_fields.select { |df| !df.template? && df.priority? }.map { |df| df.name + ": " + (df.value.present? ? df.value : "-") }.join("<br>") + "</h3>" +
                                                             "</div>" %>">
                                    <%= job.field.name + " | " + job.well.name %>
                                  </p>
                              <% end %>
                            </li>
                        <% end %>
                    <% end %>
                  </ul>
                </div>
            <% end %>
          </div>
        </div>
    <% end %>

  </div>
</div>