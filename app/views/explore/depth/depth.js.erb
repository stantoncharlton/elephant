$('#depth_loading').addClass('hidden');
$('#depth_chart').removeClass('hidden');

<% costs = get_well_costs() %>

<% n = costs.count %>
<% sum = 0 %>
<% x = 0 %>
<% y = 0 %>
<% c_sum = 0 %>
<% min_x = costs.first[:depth] %>
<% max_x = costs.first[:depth] %>
<% costs.each do |c| %>
    <% sum += (c[:depth] * c[:cost].to_f) %>
    <% x += c[:depth] %>
    <% y += c[:cost].to_f %>
    <% c_sum += c[:depth] * c[:depth] %>
    <% min_x = [c[:depth], min_x].min %>
    <% max_x = [c[:depth], max_x].max %>
<% end %>
<% a =  n * sum %>
<% b = x * y %>
<% c = n * c_sum %>
<% d = x * x %>
<% m = (a - b) / (c - d)  %>
<% e = y %>
<% f = m * x %>
<% b2 = (e - f) / n %>

<% start_y = (m * min_x) + b2 %>
<% end_y = (m * max_x) + b2 %>


var chart = AmCharts.makeChart("depth_chart", {
    "type": "xy",
    "pathToImages": "http://cdn.amcharts.com/lib/3/images/",
    "sequencedAnimation": false,
    "theme": "black",
    "trendLines": [
        {
            "finalValue": <%= end_y %>,
            "finalXValue": <%= max_x %>,
            "id": "TrendLine-1",
            "initialValue": <%= start_y %>,
            "initialXValue": <%= min_x %>,
            "lineColor": "#FF6600",
            "lineThickness": 2
        }
    ],
    "graphs": [
        {
            "balloonText": "$[[cost]]",
            "bullet": "round",
            "id": "AmGraph-1",
            "lineAlpha": 0,
            "lineColor": "#b0de09",
            "xField": "depth",
            "yField": "cost"
        }
    ],
    "guides": [],
    "valueAxes": [
        {
            "id": "ValueAxis-1",
            "axisAlpha": 0,
            "axisColor": "#FFFFFF",
            "color": "#fff",
            "titleColor": "#fff",
            "gridColor": "#FFFFFF"
        },
        {
            "id": "ValueAxis-2",
            "position": "bottom",
            "axisAlpha": 0,
            "axisColor": "#FFFFFF",
            "color": "#fff",
            "titleColor": "#fff",
            "gridColor": "#FFFFFF"
        }
    ],
    "allLabels": [],
    "balloon": {},
    "titles": [],
    "dataProvider": <%= costs.to_json.html_safe %>
});






