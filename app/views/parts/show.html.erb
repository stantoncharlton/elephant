<% provide(:title, 'Asset: ' + (@part.master_part.present? ? @part.master_part.name : @part.name)) %>

<div class="page_header">
  <h1><%= @part.master_part.present? ? @part.master_part.name : @part.name %></h1>

  <h3 class="inline">&nbsp;Asset</h3>

  <% if @part.template? %>
      <h2 class="paginated-count">Assets:
        <%= render 'layouts/paged_header', items: @parts %>
      </h2>


      <%= link_to "+ Add Asset", "#",
                  class: "bluebtn page_header_button tooltip-info",
                  id: "new_part_link",
                  "data-placement" => "bottom",
                  "data-title" => "Create new asset under this material number" %>

      <div id="new_part_fields" class="alert alert-info hidden push-down">
        <%= render 'parts/sub_part_fields', sub_part: @part %>
      </div>

  <% else %>



      <div class="btn-group inline pull-right push-right-small">
        <a class="custom-data-toggle-jobs" data-toggle="dropdown" href="#">
          Advanced Actions
        </a>
        <ul class="dropdown-menu">

          <li>
            <%= link_to "Delete Asset", @part, method: :delete,
                        data: {confirm: "Delete Asset"},
                        class: "dropdown-menu-link tooltip-info",
                        "data-placement" => "left",
                        "data-title" => "Permanently delete asset." %>
          </li>


        </ul>
      </div>

      <%= link_to "View Master Asset (" + @part.master_part.parts.count.to_s + ")",  @part.master_part, class: "activity-user-link pull-right" %>




<% end %>

</div>

<div class="well">
  <div class="pull-right">
    <span class="help-text">Material Number:</span> <%= @part.material_number %>
  </div>

  <% if @part.template? %>
      <div class="chart-block">
        <div class="chart-title">Assets</div>
        <div class="donut-chart-div job-donut-chart-div">
          <div class="donut-text part-count"><%= @parts.count %></div>
          <div class="percentage "></div>
        </div>
      </div>

      <div class="chart-block">
        <div class="chart-title">On Hand</div>
        <div class="donut-chart-div job-donut-chart-div">
          <div class="donut-text part-on-hand"><%= @parts.where(:status => Part::AVAILABLE).count %></div>
          <div class="percentage "></div>
        </div>
      </div>

  <% else %>

      <div class="inline"><span class="help-text">Serial Number: </span>
        <h3 class="blue-text inline"><%= @part.serial_number %></h3>
      </div>

      <div class="inline push-right"><span class="help-text">District Serial Number: </span>
        <b><%= @part.district_serial_number.blank? ? '-' : @part.district_serial_number %></b>
      </div>



      <hr>

      <%= render 'parts/part_status', part: @part %>
  <% end %>
</div>

<% if @part.template? %>
    <div class="push-right-small">
      <p class="help-text list-item-column">
        Serial Number
      </p>

      <p class="help-text list-item-column2">
        District Number
      </p>

      <p class="help-text list-item-column list-item-column-long">
        Status
      </p>

      <p class="help-text list-item-column list-item-column-count">
        Runs
      </p>
    </div>

    <div id="parts" class="list">
      <% @parts.each do |part| %>
          <%= render 'parts/sub_part', part: part %>
      <% end %>
    </div>

    <%= will_paginate @parts %>

<% else %>
    <h3>Run History <span class="help-text">(<%= @part.jobs.count %>)</span></h3>
    <% if @part.jobs.any? %>
        <br><br>
        <div>
          <% @part.jobs.each do |job| %>
              <% redress = PartRedress.where(:job_id => job.id).where(:part_id => @part.id).first %>

              <% if job.job_template.present? %>
                  <%= link_to job, class: "job-status job-link tooltip-info",
                              "data-placement" => "left",
                              "data-title" => "Click to open job" do %>
                      <%= render 'jobs/job_progress', job: job, show_summary_data: true, job_name: false %>


                      <% if redress.present? %>
                          <div class="content alert">
                            <span class='help-text'>Redress - </span><%= redress.created_at.strftime("%m/%d/%Y") %>
                            <% if !redress.notes.blank? %>
                                <br>
                                <span class='help-text'>Notes </span>
                                <%= redress.notes %>
                            <% end %>
                          </div>
                      <% end %>
                  <% end %>
              <% end %>


          <% end %>
        </div>
    <% else %>
        <p class="center help-text"><br>This tool has not been run on any jobs...</p>
    <% end %>
<% end %>


